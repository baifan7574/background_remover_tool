# 📊 NBFive数据存储说明

**创建日期**: 2025-12-29  
**重要性**: 了解您的数据存储在哪里

---

## 💾 数据存储方式

NBFive使用**JSON文件存储**,不是传统数据库(如MySQL/PostgreSQL)。

### 为什么用JSON文件?
✅ **简单** - 无需配置数据库服务器  
✅ **便携** - 数据文件可以直接备份/迁移  
✅ **轻量** - 适合中小规模应用  
❌ **限制** - 不适合超大规模(10万+用户)

---

## 📁 数据文件位置

### 云服务器 (生产环境)
```
路径: /home/lighthouse/background_remover_tool/data/
```

### 本地开发环境
```
路径: d:\quicktoolshub\雷达监控。\background_remover_tool\data\
```

---

## 📋 数据文件清单

### 当前服务器上的数据 (2025-12-29)

| 文件名 | 大小 | 记录数 | 说明 |
|--------|------|--------|------|
| **users.json** | 4KB | ~19行 | 用户账号(邮箱、密码、token) |
| **profiles.json** | 12KB | ~347行 | 用户资料(会员等级、个人信息) |
| **orders.json** | 4KB | 0条 | 订单记录(支付、升级) |
| **invites.json** | 4KB | ~4条 | 邀请码数据 |
| **usage.json** | 4KB | 0条 | 使用统计(每日使用次数) |
| **articles.json** | 412KB | ~1426行 | 博客文章内容 |

**总大小**: 约 440KB

---

## ✅ 您的数据是永久保存的!

### 重要说明:

1. **所有注册的用户都还在**
   - 包括您测试时注册的所有账号
   - 用户数据不会因为重启服务器而丢失
   - 即使Flask进程崩溃,数据文件仍然保留

2. **数据持久化机制**
   ```python
   # 每次用户注册/登录/修改信息时:
   1. 更新内存中的数据
   2. 立即写入JSON文件
   3. 文件保存在磁盘上
   ```

3. **数据不会丢失的情况**
   - ✅ 重启Flask进程
   - ✅ 重启服务器
   - ✅ 重新部署代码
   - ✅ Nginx重启

4. **数据会丢失的情况**
   - ❌ 手动删除data目录
   - ❌ 服务器硬盘损坏(需要备份!)
   - ❌ 误操作覆盖JSON文件

---

## 🔍 查看您的数据

### 方法1: 直接查看JSON文件

**云服务器**:
```bash
ssh root@43.130.229.184 "cat /home/lighthouse/background_remover_tool/data/users.json"
```

**本地**:
```bash
notepad d:\quicktoolshub\雷达监控。\background_remover_tool\data\users.json
```

### 方法2: 使用Python格式化查看

```bash
ssh root@43.130.229.184 "python3 -m json.tool /home/lighthouse/background_remover_tool/data/users.json"
```

### 方法3: 统计用户数量

```bash
ssh root@43.130.229.184 "python3 -c 'import json; print(len(json.load(open(\"/home/lighthouse/background_remover_tool/data/users.json\"))))'"
```

---

## 🔒 数据安全

### 当前安全措施:

1. **密码加密**: 使用bcrypt/hash加密存储
2. **Token验证**: 每次请求验证用户身份
3. **文件权限**: 只有lighthouse用户可以访问

### 建议的改进:

⚠️ **强烈建议定期备份!**

```bash
# 备份脚本示例
ssh root@43.130.229.184 "tar -czf /tmp/nbfive_data_backup_$(date +%Y%m%d).tar.gz /home/lighthouse/background_remover_tool/data/"
scp root@43.130.229.184:/tmp/nbfive_data_backup_*.tar.gz ./backups/
```

---

## 📊 数据示例

### users.json 结构:
```json
{
  "user_id_123abc": {
    "email": "test@example.com",
    "password": "$2b$12$...",  // 加密后的密码
    "token": "mock_token_123abc",
    "created_at": "2025-12-29T10:00:00"
  }
}
```

### profiles.json 结构:
```json
{
  "user_id_123abc": {
    "name": "测试用户",
    "plan": "buyout",  // 会员等级
    "email": "test@example.com",
    "avatar": null,
    "phone": null
  }
}
```

### orders.json 结构:
```json
{
  "ORDER20251229001": {
    "user_id": "user_id_123abc",
    "plan": "buyout",
    "amount": 199,
    "status": "paid",
    "created_at": "2025-12-29T10:00:00"
  }
}
```

---

## 🔄 本地 vs 云服务器数据

### 重要区别:

| 环境 | 数据位置 | 用途 | 是否同步 |
|------|---------|------|---------|
| **本地** | `d:\quicktoolshub\...` | 开发测试 | ❌ 不同步 |
| **云服务器** | `/home/lighthouse/...` | 生产环境 | - |

**注意**: 
- 本地注册的用户**只存在本地**
- 云服务器注册的用户**只存在云服务器**
- 两者**不会自动同步**!

---

## 🚀 未来升级建议

当用户量增长时,可以考虑:

1. **迁移到SQLite** (仍然是文件数据库,但性能更好)
2. **迁移到PostgreSQL/MySQL** (真正的数据库服务器)
3. **添加Redis缓存** (提升读取速度)
4. **实现主从备份** (数据安全)

---

## ❓ 常见问题

### Q: 我注册的测试账号会一直存在吗?
**A**: 是的!除非手动删除,否则永久保存。

### Q: 重启服务器会丢失数据吗?
**A**: 不会!数据保存在文件中,重启不影响。

### Q: 如何删除测试账号?
**A**: 需要手动编辑JSON文件,或通过管理后台(如果有)。

### Q: 数据文件会越来越大吗?
**A**: 会的。建议定期清理测试数据,或迁移到数据库。

### Q: 如何备份数据?
**A**: 直接复制 `data/` 目录,或使用tar打包。

---

## 📞 数据恢复

如果不小心删除了数据:

1. **检查备份**: 查看是否有备份文件
2. **查看日志**: `sk_app.log` 可能有部分信息
3. **联系云服务商**: 腾讯云可能有快照备份

---

**总结**: 
- ✅ 您的所有用户数据都安全保存在云服务器上
- ✅ 数据不会因为重启而丢失
- ⚠️ 建议定期备份,防止意外
- 💡 未来可以考虑升级到数据库系统
